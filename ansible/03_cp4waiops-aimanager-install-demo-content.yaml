#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#       __________  __ ___       _____    ________            
#      / ____/ __ \/ // / |     / /   |  /  _/ __ \____  _____
#     / /   / /_/ / // /| | /| / / /| |  / // / / / __ \/ ___/
#    / /___/ ____/__  __/ |/ |/ / ___ |_/ // /_/ / /_/ (__  ) 
#    \____/_/      /_/  |__/|__/_/  |_/___/\____/ .___/____/  
#                                              /_/            
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------------------------------"
#  Installing CP4WAIOPS v3.4.0
#
#  CloudPak for Watson AIOps
#
#  Â©2022 nikh@ch.ibm.com
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# Installs:
#
#  - IBM Operator
#  - AI Manager
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
 

- hosts: localhost
  #become: true
  #vars_files: {{ config_file }}

  tasks:
  - name: MAIN INSTALLATION LOOP-           ðŸš€ Install Modules
    debug: 
      msg: 
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "                                                                                                                                                   "
      - "       ðŸš€ CloudPak for Watson AIOps v3.4.0 - INSTALLATION                                                                                          "
      - "                                                                                                                                                   "
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"


  - name: Set Config File
    set_fact: config_file_path="./configs/cp4waiops-roks-aimanager-demo-content-34.yaml"


  - name: Show Global Config
    debug:
      var: config_file_path

  - name: Ansible check file exists.
    stat:
      path: "{{config_file_path}}"
    register: p
  - debug:
      msg: "File exists..."
    when: p.stat.exists
  - fail: msg="The specified config file {{config_file_path}} does not exist"
    when: p.stat.exists == False
      
  - name: Import Config File
    include_vars:
      file: "{{config_file_path}}"
      name: config_file

  - name: Show Global Config
    debug:
      var: config_file

  - name: Show Global Config
    debug:
      var: config_file.catalog_image



  # Loop over all Clusters
  - name: Deploy Cloud Pak for Watson AIOps Assets - Loop over Clusters
    include_role:
      name: cp4waiops-install
    loop: "{{ config_file.cp4waiops | default([]) }}"
    loop_control:
      loop_var: current_cp4waiops_cluster



